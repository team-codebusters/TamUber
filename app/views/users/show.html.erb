<% provide(:title, @user.firstname) %>
<div class="row" style = "margin:-20px">
  <aside class="col-md-4">
    <section class="user_info">
      <h2>
        <!--Weather Data in College Station-->
        <!--<%= gravatar_for @user %>-->
        <!--<%= @user.firstname %>-->
      </h2>
    </section>
  </aside>
</div>

<!DOCTYPE html>

<html>
  <head>
        

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    　　<meta name="viewport" content="width=device-width, initial-scale=1" />
　　<!--<link rel="stylesheet" type="text/css"-->
　　<!--　　media="screen and (max-device-width: 400px)"-->
　　<!--　　href="tinyScreen.css" />-->

    <meta charset="utf-8">
    <style>
          
      html, body {
        /*height: 100%;*/
        /*margin: 0;*/
        /*padding: 0;*/
        background-image: url(http://2.bp.blogspot.com/-OPYxCQCc4ao/UDBTISXA42I/AAAAAAAAAgk/smpKqpavnSs/s1600/tamu-1.jpg);
        background-size: cover;
      }

      h1
      {
          font-family: "Times New Roman";
          display: inline;
          color: black;
          font-weight: bold;
          text-align: left;
          font-size: 2.5em;   
      }
      h2,h3
      {
        font-family: "Times New Roman";
        background: #590000;
        color: white;
      }
      
      
      
      table, td, tr, th {
        /*border: 2px solid black;*/
        margin-top: 5px;
        text-align: left;
        vertical-align: center;
        padding: 5px
        /*font-size: 50px;*/
        font-family: "Times New Roman";
      }
      
      td{
        font-size: 14px;
      }

    @media screen and (min-width: 0px) and (max-width: 700px) {
      

      
      .top{
          width:100%;
          margin-top:140px;
      }
      .navbar, .navbar-fixed-top, .navbar-inverse{
        background-color:#500000;
        border-color:#500000;
        margin-bottom: 50px;
      }
      
      #dash {
        width:100%;
      }
      
      #weather{

        width:100%;
        margin-bottom: 10px;
      }
      
      #Em_contact{

          width:100%;
          margin-top:0px;
          padding-top:22px;
      }
      
      #EM-form {
        width:100%;
        margin-left:0px;
        margin-right:0px;
        padding-left:0px;
        padding-right:0px;
      }
      
      
      #ride {
        margin-top = 200px;
        padding = 10px;
        text-align: right;
        width:100%;
        position: relative;
      }
    }

    @media screen and (min-width: 701px) and (max-width: 3000px) {
  
       .top{
          margin-top:0px;
          padding-top:5px;
      }
      .navbar, .navbar-fixed-top, .navbar-inverse{
        background-color:#500000;
        border-color:#500000;
        margin-bottom:0px;
      }
      
      #dash {
        float: right;
        width:40%;
      }
      
      #weather{
        float: left; 
        width:40%;
        margin-bottom: 10px;
      }
      
      #Em_contact{
          float:left;
          margin-top:0px;
          padding-top:22px;
          
      }
      
      #contactform {
        float: left;
        width:40%;
      }
      
      #EM-form {
        width:100%;
        margin-left:0px;
        margin-right:0px;
        padding-left:0px;
        padding-right:0px;
        text-align:center;
      }
      
      #ride {
        margin-top = 200px;
        padding = 10px;
        text-align: right;
        float:right; width:40%;
        position: relative;
      }
}

    </style>
  </head>
  <body>

  <div class="top" align="center">
      <a style="width:100%" class="weatherwidget-io" href="https://forecast7.com/en/30d63n96d33/college-station/" data-label_1="COLLEGE STATION" data-label_2="WEATHER" data-theme="ruby" data-basecolor="#500000" >
        COLLEGE STATION WEATHER</a>    
  </div>
  
  
  
  
  <div id="weather">
        <h2> Weather Data for College Station </h2>
        <table id="weather_results"></table>
  </div>
    
    
  <div id="dash">
    <h2>Dashboard</h2>
    <table class="table table-striped" >

      <tr>
        <td> Since last update</td>
        <td id="time_diff" ><%= @diff_time%></td>
      </tr>
      <tr style = "background: white">
        <td> Tire Pressure</td>

        <td id="tire_pressure" ><%= @vehicle_stats['tire_pressure']%></td>
      </tr>
      <tr>
        <td>Battery Level</td>
        <td id="battery_level"><%= @vehicle_stats['battery_level'] %></td>
      </tr>
      <tr style = "background: white">
        <td>Lidar Status</td>
        <td id="lidar_status"><%= @vehicle_stats['lidar_status'] %></td>
      </tr>
    </table>
  </div>
  


	  <div id="ride">
      <h2> Ride Information</h2>
      <table class="table table-striped">
        <tr>
          <td> Student Name</td>
          <td> Pickup </td>
          <td> Destination </td>
        </tr>
        
        <tr style = "background: white">
          <td> Alice </td>
          <td> ETB </td>
          <td> HRBB </td>
        </tr>
        <tr>
          <td> Bob </td>
          <td> MEOB </td>
          <td> MSC </td>
        </tr>
        <tr style = "background: white">
          <td> Mary </td>
          <td> WEB </td>
          <td> Evans </td>
        </tr>
      </table>
    </div>


    <div id="contactform">
      <h2> Contact Information</h2>
      <table class="table table-striped">
        <tr>
          <td> Administrative</td>
          <td> (979) 317-2000 </td>
        </tr>
        
        <tr style = "background: white">
          <td> UPD </td>
          <td> (979) 845-2345 </td>
        </tr>
      </table>
    </div>


	<script>
!function(d,s,id)
{
  var js,fjs=d.getElementsByTagName(s)[0];
  if(!d.getElementById(id))
    {js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';
    fjs.parentNode.insertBefore(js,fjs);
      
    }
}(document,'script','weatherwidget-io-js');
</script>
	
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  
  
<script type = "text/javascript" language = "javascript">
  $(document).ready(function() {

      function update_values(){
                var proxy = 'https://cors-anywhere.herokuapp.com/';
                    $.ajax({
                    url: proxy + 'http://47.218.218.78:8080/car_info.json',
                    success:function(data1) { console.log(data1); 
                    past_str = data1['time'].split("_");
                    var past = new Date(past_str[0], past_str[1]-1, past_str[2], past_str[3], past_str[4],past_str[5]).getTime();
                    var now = new Date().getTime();
                    console.log(now)
                    console.log(past)
                    var msec = Math.abs(now-past)/1000;
              
                    
                    hh = Math.floor(msec  / 60 / 60);
                    msec = msec - hh  * 60 * 60;
                     mm = Math.floor(msec / 60);
                    msec = msec - mm  * 60;
                     ss = Math.floor(msec);
                      
                    $('#time_diff').html("Hour:"+ hh +" Minute:" + mm + " Second:"+ss); 
                    $('#tire_pressure').html( data1['tire pressure']);
                    $('#battery_level').html( data1['battery']);
                    $('#lidar_status').html( data1['lidar status']);
                    setTimeout(update_values,6000);}
                    });
              
                
        };
      $(document).ready(function(){
      setTimeout(update_values,6000);
      });
       
      });
 </script>
  
  
  <script>
    // api key for darksky
    var apikey = "07859817882e1a3b466848964a578187";
    var lat = "30.617930";
    var long = "-96.337648";
    jQuery(document).ready(function(){
    console.log("Ready!");
    weatherFunction();  // when the page has loaded, run weatherFunction
    $('#weather_results').show();
  });
  
  
  function weatherFunction(){
    // Create a request variable and assign a new XMLHttpRequest object to it.
    
// IMPORTANT! UNCOMMENT FOR API TO WORK

    // var html2 = '';
    // // test data stub
    // var data = {
    //   daily: {
    //       summary: "Rain tomorrow and Monday, with high temperatures falling to 50F"
        
    //   },
    //   currently:{
    //       temperature: 85,
    //       visibility: 10,
    //       windSpeed: 3.78,
    //       precipIntensity: 0.22,
    //       precipProbability: 0.45,
    //       humidity: 0.24
    //   }
    // }
    // IF YOU WANT TO USE API, COMMENT THIS OUT; ELSE uncomment this out
    // *************************Test Stub*******************
    
    // html2 += '<table class="table table-striped"><tr><th>Temperature(Farenheit)</th><td>' + data.currently.temperature + '</th></td></tr>'
    //     + '<tr><th>Humidity</th><td>' + data.currently.humidity + '</td><tr>'
    //     + '<tr><th>Probability of Rain(%)</th><td>' + data.currently.precipProbability * 100 + ' %' + '</td></tr>'
    //     + '<tr><th>Intensity of Rain</th><td>' + data.currently.precipIntensity + '</td></tr>'
    //     + '<tr><th>Visibility</th><td>' + data.currently.visibility + '</td></tr>'
    //     + '<tr><th>WindSpeed</th><td>' + data.currently.windSpeed + '</td></tr>'
    //     + '<tr><th>Summary</th><td>' + data.daily.summary +'</td></tr></table>';
    // $('#weather_results').append(html2);

    // ******************************************************
    // IF YOU WANT TO USE API, UNCOMMENT THIS OUT; ELSE comment this out
    // *************************API*******************
        var url1 = "https://api.darksky.net/forecast/";
        var html = '';
        var proxy = 'https://cors-anywhere.herokuapp.com/';
        var apiLinkDS = url1+apikey+"/"+lat+","+long;
        
        $.ajax({
          url: proxy + apiLinkDS,
          success:function(data) { console.log(data); 
          html += '<table class="table table-striped"><tr><th>Temperature(Farenheit)</th><td>' + data.currently.temperature + '</th></td>'
              + '<tr style = "background: white"><th>Humidity</th><td>' + data.currently.humidity + '</td>'
              + '<tr><th>Probability of Rain(%)</th><td>' + data.currently.precipProbability * 100 + ' %' + '</td>'
              + '<tr style = "background: white"><th>Intensity of Rain</th><td>' + data.currently.precipIntensity + '</td>'
              + '<tr><th>Visibility</th><td>' + data.currently.visibility + '</td>'
              + '<tr style = "background: white"><th>WindSpeed</th><td>' + data.currently.windSpeed + '</td>'
              + '<tr><th>Summary</th><td>' + data.daily.summary +'</td></tr></table>';

          $('#weather_results').append(html);
          }
        });
        // ******************************************************
      };

  </script>


    
</body>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
</html>